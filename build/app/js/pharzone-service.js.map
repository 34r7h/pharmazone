{"version":3,"sources":["pharzone-service.es6"],"names":[],"mappings":"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","file":"pharzone-service.js","sourcesContent":["(() => {\n  'use strict';\n\n  class Pharzone {\n    constructor($log, $state, $firebaseObject, $rootScope) {\n/*\n      this.promise = (target, data)=> {\n        $log.debug('Promising data..', target +': '+data);\n        setTimeout(()=> {\n          if (data) {\n            $rootScope.$apply( ()=> {\n              target.data = data;\n            });\n            return target;\n          } else {\n            this.promise($rootScope, data);\n            $log.debug('looking for data..');\n          }\n        }, 500);\n      };\n*/\n      let vm = this;\n      this.test = 'ALL SYSTEMS OPERATIONAL';\n      this.cart = {};\n      this.index = {products:{},users:{},orders:{}};\n      this.data = {\n\t      db: ()=>{\n\t\t      let ref = new Firebase('https://pharzone.firebaseio.com/');\n\t\t      var dbObj = $firebaseObject(ref).$loaded().then((data)=>{\n\t\t\t      $log.debug('dbObj', data);\n\t\t\t      return data;\n\t\t      });\n\t\t      return dbObj;\n\t      },\n        products: (()=>{\n          let ref = new Firebase('https://pharzone.firebaseio.com/products');\n          var dbObj = $firebaseObject(ref).$loaded().then((data)=>{\n            $log.debug('Looping through products to index', data);\n            angular.forEach(data, (product, key) =>{\n              $log.debug('Looping through products to index');\n              this.index['products'][product.url] = key;\n            });\n            $log.debug('this.index',this.index);\n            $log.debug('productsObj', data);\n            return data;\n          });\n          return dbObj;\n        })(),\n        users:  (()=>{\n          let ref = new Firebase('https://pharzone.firebaseio.com/users');\n          var dbObj = $firebaseObject(ref).$loaded().then((data)=>{\n            $log.debug('userObj', data);\n            return data;\n          });\n          return dbObj;\n        })(),\n        orders:  ()=>{\n          let ref = new Firebase('https://pharzone.firebaseio.com/orders');\n          var dbObj = $firebaseObject(ref).$loaded().then((data)=>{\n            $log.debug('ordersObj', data);\n            return data;\n          });\n          return dbObj;\n        }\n      };\n\n\t    this.api = {\n        promise: (target, data)=> {\n          $log.debug(\"promising data\");\n          $log.debug(target , data);\n          setTimeout(()=> {\n            if (data) {\n              $rootScope.$apply( ()=> {\n                target.data = data;\n              });\n              return target;\n            } else {\n              this.api.promise(target, data);\n              $log.debug('looking for data..');\n            }\n          }, 500);\n        },\n        make: (type, object)=>{\n          if(!this.data[type].object){\n            this.data[type].push(object);\n            this.data[type].$save();\n          }\n        },\n        getTime: () => {\n          return Date.now();\n        },\n\t\t    addToCart: (product, cart, qty) => {\n          if(!qty) qty = 1;\n\t\t      $log.info('Adding', qty +' '+ product);\n          product['qty']= qty;\n          if(cart[product.name]){\n            console.log('Already in cart.');\n          } else {\n            cart[product.name]=product;\n            $log.info('To cart', cart);\n            return cart;\n          }\n\n\t      },\n        cartTotal: (items) => {\n          // $log.debug('calculating totals', items);\n          var total = 0;\n          angular.forEach(items, (item)=>{\n            var itemTotal = item.price * item.qty;\n            total = total + itemTotal;\n          });\n          return total;\n        },\n        checkout: (order, orderTotal, time, vm) => {\n          // var timestamp = Date.now();\n          order.total = orderTotal;\n//        this.data.orders[time]=order;\n\n        $log.debug('getDb() - checkout');\n        if(this.data.orders){\n          this.data.orders.$$state.value[time]=order;\n          this.data.orders.$$state.value.$save();\n          $log.debug('this.data.orders.$$state.value',this.data.orders);\n        }\n        // TODO wire to db\n        $log.debug(this.data.orders, 'orderTotal @ ' + time);\n        $log.debug($state, 'State stuff');\n        var href = $state.href(\"pharzone.cart.payment\", { order: time });\n        $state.go('pharzone.cart.payment',{order:time});\n        $log.debug($state, 'State stuff');\n\n        }\n\t    }\n    }\n\n    get() {\n      return 'Pharzone';\n    }\n  }\n\n  /**\n   * @ngdoc service\n   * @name pharzone.service:Pharzone\n   *\n   * @description\n   *\n   */\n  angular\n    .module('pharzone')\n    .service('Pharzone', Pharzone);\n}());\n"],"sourceRoot":"/source/"}